
  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'date_time'
      - 'time_date'
      - 'time_utc'

  - platform: miflora
    mac: 'C4:7C:8D:65:F1:26'
    name: Flower 1
    force_update: false
    median: 3
    monitored_conditions:
      - moisture
      - light
      - temperature
      - conductivity
      - battery
#  - platform: miflora
#    mac: 'C4:7C:8D:65:F1:26'
#    name: Flower 2
#    force_update: false
#    median: 3
#    monitored_conditions:
#      - moisture
#      - light
#      - temperature
#      - conductivity
#      - battery

  - platform: netatmo
    station: WeatherCicciput
    modules:
      - Regenmesser
      - Outdoor
      - Indoor

  - platform: systemmonitor
    resources:
    - type: disk_use_percent
      arg: /
    - type: memory_free
    - type: memory_use_percent
    - type: processor_use
    - type: last_boot

  - platform: uptime
    name: HomeAssistant attivo da

  - platform: github
    access_token: !secret github_access_token
    repositories:
      - path: 'AndrePier/HomeAssistant'
      - path: 'daxda/HomeAssistant'

#  - platform: command_line # funziona solo su Raspberry
#    name: CPU Temperature
#    command: cat /sys/class/thermal/thermal_zone0/temp
#    unit_of_measurement: Â°C
#    value_template: '{{ value | multiply(0.001) | round(1) }}'
  - platform: cert_expiry
    host: !secret ddomain
  - platform: moon

  - platform: darksky
    api_key: !secret darksky_apikey
    forecast:
      - 0
    language: it
    monitored_conditions:
      - summary
      - icon
      - temperature_high
      - apparent_temperature
      - wind_speed
      - cloud_cover
      - precip_intensity

  - platform: history_stats
    name: Ore alla TV oggi
    entity_id: media_player.philips_tv
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
  - platform: history_stats
    name: Ore alla TV settimana
    entity_id: media_player.philips_tv
    state: 'on'
    type: time
    start: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - now().weekday() * 86400 }}'
    end: '{{ now() }}'

############ Da qui in poi tutti i sensori creati tramite template
  - platform: template
    sensors:

      giornianatale:
        friendly_name: 'Giorni al Natale'
        value_template: '{{ (( as_timestamp(strptime("25.12."+ now().strftime("%Y"), "%d.%m.%Y")) - as_timestamp(strptime(now().strftime("%d")+"."+now().strftime("%m")+"."+now().strftime("%Y"), "%d.%m.%Y"))) / 86400 ) | round(0) }}' #'{{ (( as_timestamp(now()) - as_timestamp(strptime("25.12."+now().strftime("%Y"), "%d.%m.%Y")) ) / 86400 ) | round(0) }}'
        unit_of_measurement: "Giorni"
        entity_id: sensor.date
        icon_template: mdi:calendar

      fasilunari:
        friendly_name: "Luna"
        icon_template: >
          {% if is_state('sensor.moon', 'new_moon') %}
            mdi:circle-outline
          {% elif is_state('sensor.moon', 'waxing_crescent') %}
            mdi:arrow-up-bold
          {% elif is_state('sensor.moon', 'first_quarter') %}
            mdi:arrow-up-bold
          {% elif is_state('sensor.moon', 'waxing_gibbous') %}
            mdi:arrow-up-bold
          {% elif is_state('sensor.moon', 'full_moon') %}
            mdi:brightness-1
          {% elif is_state('sensor.moon', 'waning_gibbous') %}
            mdi:arrow-down-bold
          {% elif is_state('sensor.moon', 'last_quarter') %}
            mdi:arrow-down-bold
          {% elif is_state('sensor.moon', 'waning_crescent') %}
            mdi:arrow-down-bold
          {% endif %}
        value_template: >
          {% if is_state('sensor.moon', 'new_moon') %}
            Luna Nuova
          {% elif is_state('sensor.moon', 'waxing_crescent') %}
            Luna Crescente
          {% elif is_state('sensor.moon', 'first_quarter') %}
            Primo Quarto
          {% elif is_state('sensor.moon', 'waxing_gibbous') %}
            Gibbosa Crescente
          {% elif is_state('sensor.moon', 'full_moon') %}
            Luna Piena
          {% elif is_state('sensor.moon', 'waning_gibbous') %}
            Gibbosa Calante
          {% elif is_state('sensor.moon', 'last_quarter') %}
            Ultimo Quarto
          {% elif is_state('sensor.moon', 'waning_crescent') %}
            Luna Calante
          {% endif %}

#############################################################
################       SHELLY SENSORI         ###############
#############################################################

  - platform: mqtt
    name: "Consumo Presa Ingresso"
    state_topic: "shellies/shelly1pm-B1DD37/relay/0/power"
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Alert Presa Ingresso"
    state_topic: "shellies/shelly1pm-B1DD37/overtemperature"
    qos: 0
  - platform: integration
    source: sensor.consumo_presa_ingresso
    name: kWh Presa Ingresso
    unit_prefix: k
    round: 2


  - platform: mqtt
    name: "Consumo Presa Bagno"
    state_topic: "shellies/shelly1pm-B1D5E2/relay/0/power"
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Alert Presa Bagno"
    state_topic: "shellies/shelly1pm-B1D5E2/overtemperature"
    qos: 0
  - platform: integration
    source: sensor.consumo_presa_bagno
    name: kWh Presa Bagno
    unit_prefix: k
    round: 2


  - platform: mqtt
    name: "Consumo Presa Pranzo"
    state_topic: "shellies/shelly1pm-B1DE80/relay/0/power"
    unit_of_measurement: "W"
  - platform: mqtt
    name: "Alert Presa Pranzo"
    state_topic: "shellies/shelly1pm-B1DE80/overtemperature"
    qos: 0
  - platform: integration
    source: sensor.consumo_presa_pranzo
    name: kWh Presa Pranzo
    unit_prefix: k
    round: 2


  - platform: mqtt
    name: "Consumo Presa Corridoio"
    state_topic: "shellies/shellyswitch-5A449F/relay/power"
    unit_of_measurement: "W"
  - platform: integration
    source: sensor.consumo_presa_corridoio
    name: kWh Presa Corridoio
    unit_prefix: k
    round: 2
